# 开发文档(首页及用户登录模块)



## 1. 首页（index.html）

### 1.1 概述

OA系统主页面，为各应用功能提供链接和适当展示。

### 1.2 接口说明

| 功能     | 注册接口                               | 请求方式 |
| -------- | -------------------------------------- | -------- |
| 员工管理 | http://127.0.0.1:8000/management/      | GET      |
| 部门管理 | http://127.0.0.1:8000/department/      | GET      |
| 通讯录   | http://127.0.0.1:8000/address_book/    | GET      |
| 考勤记录 | http://127.0.0.1:8000/empoyeeWorkInfo/ | GET      |
| 通知公告 | http://127.0.0.1:8000/notice/          | GET      |
| 工作报告 | http://127.0.0.1:8000/report/          | GET      |
| 个人设置 | http://127.0.0.1:8000/index/My_info/   | GET      |
| 游戏模块 | http://127.0.0.1:8000/game/            | GET      |



## 2. 用户模块（userapp）

### 2.1 概述

办公系统用户注册登录认证、查找及相关信息修改。

### 2.2 事件定义

#### 2.2.1  用户注册

办公系统用户注册用，只有注册用户才能登录系统。

#### 2.2.2 用户登录

用户可通过此功能进行用户登陆操作，只有登陆的用户方可执行相关操作。

#### 2.2.2 修改个人信息

登录用户可以修改自己个人信息。

### 2.3 数据库结构

| 字段名       | 类型         | 作用     | 备注 |
| ------------ | ------------ | -------- | ---- |
| username     | varchar(11)  | 用户名   |      |
| nickname     | varchar(30)  | 昵称     |      |
| email        | varchar(50)  | 邮箱     |      |
| password     | varchar(32)  | 密码     |      |
| sign         | varchar(50)  | 个人签名 |      |
| info         | varchar(150) | 个人描述 |      |
| avatar       | varchar(100) | 头像     |      |
| created_time | datetime     | 创建时间 |      |
| updated_time | datetime     | 更新时间 |      |
| phone        | int          | 电话号码 |      |
| isActive     | bit          | 是否启用 |      |
| is_induction | bit          | 是否入职 |      |

> 

### 2.4 接口说明

| 功能         | 注册接口                                   | 请求方式 |
| ------------ | ------------------------------------------ | -------- |
| 用户注册     | http://127.0.0.1:8000/v1/users/reg         | POST     |
| 用户登录     | http://127.0.0.1:8000/v1/users/login       | POST     |
| 忘记密码     | http://127.0.0.1:8000/v1/users/newPsw      | POST     |
| 个人信息修改 | http://127.0.0.1:8000/v1/users/change_info | POST     |

#### 2.4.1 用户注册

- 请求格式

| 字段      | 含义     | 类型 | 备注 |
| --------- | -------- | ---- | ---- |
| username  | 用户名   | { }  |      |
| email     | 邮箱     | char |      |
| password1 | 密码1    | char |      |
| password2 | 密码2    | char |      |
| telephone | 电话号码 | int  |      |

> 请求示例：
>
> ```python
> {‘username’: jack, ‘email’: ‘abc@qq.com’, ‘password1’: ‘abcdef’, ‘password2’: ‘abcdef’，'telephone':13572028765}
>    ```
>    

- 响应格式

| 字段     | 含义     | 类型 | 备注                    |
| -------- | -------- | ---- | ----------------------- |
| code     | 响应码   | int  | 默认为200，异常详见下表 |
| username | 用户名   | char | 无                      |
| data     | 返回数据 | json | 包含token               |

> 响应示例：
>
> ```python
> {‘code’: 200 , ‘username’: ‘abc’, ’data’: {‘token’: ‘asdadasd.cvreijvd.dasdadad’} }
> ```

- 异常码

  | 异常码 | 含义                 | 备注                     |
  | ------ | -------------------- | ------------------------ |
  | 202    | 请求中无内容         |                          |
  | 203    | 请求中未提交用户名   |                          |
  | 204    | 请求中未提交邮箱     |                          |
  | 205    | 请求中未提交密码     |                          |
  | 206    | 两次提交的密码不一致 | 即password1 != password2 |
  | 207    | 用户名已存在         |                          |
  | 500    | 服务器异常           |                          |

#### 2.4.2 修改用户个人信息接口

- 数据接口

  URL: [http://127.0.0.1:8000/v1/users](http://127.0.0.1/users/)/<username>

  json 具体参数如下

  | 字段     | 含义     | 类型 | 备注   |
  | -------- | -------- | ---- | ------ |
  | sign     | 个人签名 | char | 非必填 |
  | info     | 个人描述 | char | 非必填 |
  | nickname | 昵称     | char | 非必填 |

  该请求需客户端在HTTP header 里添加 token,  格式如下：

  Authorization ： token

  请求示例：{‘sign’:xxx, ‘info’:xxxx, ‘nickname’:xxxx}

| 字段 | 含义           | 类型 | 备注      |
| ---- | -------------- | ---- | --------- |
| code | 响应码         | int  | 默认为200 |
| data | 返回的数据类型 | [ ]  |           |

> 响应示例：
>
> ```python
> 响应示例：{‘code’:200, ‘username’:’char’}
>  ```

#### 2.4.3 异常码

| 异常码 | 含义   | 备注             |
| ------ | ------ | ---------------- |
| 202    | 空提交 | 请求中无任何信息 |

异常响应示例:

{‘code’:202, ‘error’: ‘please put data’}

|      |      |      |      |
| ---- | ---- | ---- | ---- |
|      |      |      |      |

> 响应示例：
>

> ```python
>result = {
> 'code': 200,
> 	'data':[
>  		{'salary_id': 10001202011, 'year': 2020, 'month': 11, 'is_attendance':false,
> 'late_in_mon':5}
>  ]
> }
>    ```

## ***3  上传头像接口***

URL:[http://127.0.0.1:8000/v1/users](http://127.0.0.1/users/)/<username>/avatar

### ***3.1 请求方式***

POST  multipart/form-data

### ***\*3.2 请求格式\****

表单 具体表单参数如下

| 字段   | 含义         | 类型 | 备注 |
| ------ | ------------ | ---- | ---- |
| avatar | 表单中的图片 | char | 必填 |

该请求需客户端在HTTP header 里添加 token,  格式如下：

Authorization ： token

### ***3.3 响应格式*** 

json, 具体参数如下

| 字段     | 含义   | 类型 | 备注             |
| -------- | ------ | ---- | ---------------- |
| code     | 状态   | Int  | 正常为200        |
| username | 用户名 | char | 此次修改的用户名 |

 

## ***4 获取token*** 

【即登陆请求】 http://127.0.0.1:8000/v1/tokens

### ***4.1 请求方式***

POST

### ***4.2 请求格式***

json ,  具体参数如下

| 字段     | 含义   | 类型 | 备注 |
| -------- | ------ | ---- | ---- |
| username | 用户名 | char | 必填 |
| password | 密码   | char | 必填 |

请求示例： {‘username’: ‘xxx’, ‘password’: ‘yyy’}

### ***4.3 响应格式***

json, 具体参数如下

| 字段     | 含义                   | 类型 | 备注                     |
| -------- | ---------------------- | ---- | ------------------------ |
| code     | 200                    | Int  | 正常为200，异常码请见5.4 |
| username | 用户名                 | char |                          |
| data     | 返回具体数据都在data中 | {}   | {‘token’: ‘xxxx’-char}   |

响应示例：

{‘code’: 200,  ‘username’: ‘asc’,  ‘data’: {‘token’: ‘zdsadasd’}}

### ***4.4 异常码***

| 异常码 | 含义               | 备注 |
| ------ | ------------------ | ---- |
| 201    | 请求方式并非POST   |      |
| 202    | 请求为空           |      |
| 203    | 请求中未提交用户名 |      |
| 205    | 请求中未提交密码   |      |
| 208    | 用户名不存在       |      |
| 209    | 提交的密码不正确   |      |

异常码响应示例

{‘code’: 205, ‘error’: ‘no password’}