# 开发文档

---

## 0. 各API通用规范：

- 开发环境

| 类别     | 软件及版本     |
| -------- | -------------- |
| 开发环境 | ubuntu 18.04.1 |
| 开发语言 | python 3.6.9   |
| 后端框架 | django 2.2.12  |
| 数据库   | mysql 5.7.29   |
| 前端框架 | layui          |

- 通信协议：HTTP
- API规范：尽量满足RESTful

## 1. 员工信息API

### 1.1 概述

公司员工的信息管理模块

### 1.2 事件定义

#### 1.2.1 员工列表

在APIframe.html框架基础上，开发新的页面，用于显示公司所有员工信息。同时可以对员工信息进行删除，通过id来搜索员工，并对其进行修改。

#### 1.2.2 增加员工

在APIframe.html框架基础上，开发新的页面，用于增加新的员工。

### 1.3 数据库结构

| 字段名     | 类型        | 作用     | 备注1 | 备注2             |
| ---------- | ----------- | -------- | ----- | ----------------- |
| eid        | int         | 员工编号 |       | 主键              |
| ename      | varchar(20) | 员工姓名 |       | 非空              |
| sex        | varchar(10) | 员工性别 |       | 非空              |
| age        | int         | 员工年龄 |       | 非空              |
| birthday   | date        | 员工生日 |       |                   |
| position   | varchar(30) | 员工职位 |       | 默认为普通员工    |
| ephone     | varchar(11) | 员工电话 |       | 非空              |
| address    | varchar(75) | 联系地址 |       | 非空              |
| indate     | date        | 入职日期 |       | auto_now_add=True |
| eemail     | email       | 员工邮箱 |       |                   |
| is_active  | bool        | 员工状态 |       | 默认为1           |
| department |             | 部门     |       | 外键(关联部门表)  |

> 部门表为主表，一对多，级联删除。

### 1.4 接口说明

| 功能     | 注册接口                                         | 请求方式 |
| -------- | ------------------------------------------------ | -------- |
| 员工列表 | http://127.0.0.1:8000/v1/employee/               | GET      |
| 删除员工 | http://127.0.0.1:8000/v1/employee/               | DELETE   |
| 查询员工 | http://127.0.0.1:8000/v1/employee/ + employee_id | POST     |
| 添加员工 | http://127.0.0.1:8000/v1/employee/               | POST     |

#### 1.4.1 员工列表

- 响应格式

| 字段 | 含义                         | 类型 | 备注                   |
| ---- | ---------------------------- | ---- | ---------------------- |
| code | 响应码                       | int  | 默认为200,异常详见下表 |
| data | 返回具体的数据都包含在data中 | [  ] |                        |

>  响应示例：
>
>  ```python
>  result = {
>      'code': 200,
>  	'data':[
>  		{'eid': 1,'ename': 'tom','sex': '男','birthday': '1999-09-01','position': '普通员工', ,'ephone':13333333333, 'address': '北京-东城', 'indate': '2020-11-14','eemail':'13333333333@163.com','is_activate':1,'department_id':1}
>          {'eid': 2,'ename': 'jerry','sex': '男','birthday': '1999-10-10','position': '普通员工', ,'ephone':14444444444, 'address': '北京-东城', 'indate': '2020-11-14','eemail':'14444444444@163.com','is_activate':1,'department_id':2}
>          ...
>  	]
>  }
>  ```

#### 1.4.2 删除员工

- 响应格式

| 字段 | 含义   | 类型 | 备注                   |
| ---- | ------ | ---- | ---------------------- |
| code | 响应码 |      | 默认为200,异常详见下表 |

>  响应示例：
>
>  ```python
>  result = {'code': 200}
>  ```

- 异常码

| 异常码 | 含义                               | 备注 |
| ------ | ---------------------------------- | ---- |
| 303    | 数据库没有此员工（此员工已经离职） |      |

#### 1.4.3 查询员工

- 请求格式

| 字段        | 含义     | 类型 | 备注 |
| ----------- | -------- | ---- | ---- |
| employee_id | 员工编号 | char |      |

> 请求示例：
>
> ```python
> json = {'employee_id': employee_id}
> ```

- 响应格式

| 字段 | 含义         | 类型 | 备注                    |
| ---- | ------------ | ---- | ----------------------- |
| code | 响应码       | int  | 默认为200，异常详见下表 |
| data | 存储响应数据 | [  ] |                         |

> 响应示例：
>
> ```python
> result = {
>     'code': 200,
> 	'data':[
> 		{'eid': 1,'ename': 'tom','sex': '男','birthday': '1999-09-01','position': '普通员工', ,'ephone':13333333333'address': '北京-东城', 'indate': '2020-11-14','eemail':'13333333333@163.com','is_activate':1,'department_id':3}
> 	]
> }
> ```

- 异常码

| 字段 | 含义                     | 类型 | 备注 |
| ---- | ------------------------ | ---- | ---- |
| 304  | 没有找到此编号的员工信息 |      |      |

#### 1.4.4 添加员工

- 请求格式

| 字段                | 含义     | 类型 | 备注 |
| ------------------- | -------- | ---- | ---- |
| employee_id         | 员工编号 |      |      |
| employee_name       | 姓名     |      |      |
| employee_sex        | 性别     |      |      |
| employee_age        | 年龄     |      |      |
| employee_birthday   | 生日     |      |      |
| employee_position   | 职位     |      |      |
| employee_phone      | 电话     |      |      |
| employee_address    | 地址     |      |      |
| employee_email      | 邮件     |      |      |
| employee_department | 部门     |      |      |
| username            | 用户名   |      |      |

> 请求示例：
>
> ```python
> json = {
> 	'eid': employee_id,
>     'ename': employee_name,
>     'sex': employee_sex,
>     'age': employee_age,
>     'birthday': employee_birthday,
>     'position': employee_position,
>     'ephone': employee_phone,
>     'address': employee_address,
>     'eemail': employee_email,
>     'department': employee_department,
>     'username': username
> }
> ```

- 响应格式

| 字段 | 含义   | 类型 | 备注                    |
| ---- | ------ | ---- | ----------------------- |
| code | 响应码 | int  | 默认为200，异常详见下表 |

> 响应示例：
>
> ```python
> result = {'code': 200}
> ```

- 异常码

| 字段 | 含义                         | 类型 | 备注 |
| ---- | ---------------------------- | ---- | ---- |
| 301  | 员工信息未被成功添加到数据库 |      |      |
| 302  | 没有此部门                   |      |      |

## 2. 员工考勤API

### 2.1 概述

公司员工考勤模块，包括员工签到(员工)和员工考勤查询(管理员)

### 2.2 事件定义

#### 2.2.1 员工签到

员工在员工考勤系统中，点击日历进行每日签到。

#### 2.2.2 考勤查询

管理员系统查询公司员工每人每年每月的签到记录。

### 2.3 数据库结构

| 字段名        | 类型 | 作用             | 备注       |
| ------------- | ---- | ---------------- | ---------- |
| year          | int  | 年               |            |
| month         | int  | 月               |            |
| is_attendance | bool | 是否满勤         | 默认为true |
| late_in_mon   | int  | 当月迟到次数     | 默认为0    |
| overtime      | int  | 加班时间         |            |
| salary        | char | 薪资条编号(外键) |            |

> 考勤表和薪资表为一对一关系

### 2.4 接口说明

| 功能         | 注册接口                                  | 请求方式 |
| ------------ | ----------------------------------------- | -------- |
| 员工签到     | http://127.0.0.1:8000/v1/sign/ + username | POST     |
| 考勤列表     | http://127.0.0.1:8000/v1/sign             | GET      |
| 查询考勤记录 | http://127.0.0.1:8000/v1/sign + salary_id | POST     |

#### 2.4.1 员工签到

- 请求格式

| 字段     | 含义             | 类型 | 备注 |
| -------- | ---------------- | ---- | ---- |
| date     | 存储年月日时分秒 | { }  |      |
| username | 员工账号         | int  |      |

> 请求示例：
>
> ```python
> json = {
>     'username': 100003333, 
>    'date': {'year': 2020, 'month': 11, 'date': 21, 'hours': 10, 'minutes': 13, 'seconds': 7}
> }
>```
> 

- 响应格式

| 字段 | 含义   | 类型 | 备注                    |
| ---- | ------ | ---- | ----------------------- |
| code | 响应码 | int  | 默认为200，异常详见下表 |

> 响应示例：
>
> ```python
> result = {'code': 200}
> ```

- 异常码

| 字段 | 含义                     | 类型 | 备注 |
| ---- | ------------------------ | ---- | ---- |
| 501  | 用户身份验证错误         |      |      |
| 504  | 薪资表中已有该条薪资记录 |      |      |

#### 2.4.2 考勤列表

- 响应格式

| 字段 | 含义           | 类型 | 备注      |
| ---- | -------------- | ---- | --------- |
| code | 响应码         | int  | 默认为200 |
| data | 返回的数据类型 | [ ]  |           |

> 响应示例：
>
> ```python
> result = {
>  'code': 200,
> 	'data':[
> 		{'salary_id': 10001202011, 'year': 2020, 'month': 11, 'is_attendance':false,
> 'late_in_mon':5}
> 		{...}
> 		{...}
> 	]
> }
> ```

#### 2.4.3 查询考勤列表

- 请求格式

| 字段      | 含义       | 类型 | 备注 |
| --------- | ---------- | ---- | ---- |
| salary_id | 薪资条编号 |      |      |

> 请求示例：
>
> ```python
> json = {'salary_id': salary_id}
> ```

- 响应格式

| 字段 | 含义           | 类型 | 备注      |
| ---- | -------------- | ---- | --------- |
| code | 响应码         | int  | 默认为200 |
| data | 返回的数据类型 | [ ]  |           |

> 响应示例：
>
> ```python
> result = {
>  'code': 200,
> 	'data':[
> 		{'salary_id': 10001202011, 'year': 2020, 'month': 11, 'is_attendance':false,
> 'late_in_mon':5}
>     ]
> }
> ```

## 3.部门信息API

### 3.1 事件概述

此文档为部门管理相关的API详情 <department 模块>

### 3.2 事件定义

#### 3.2.1 部门信息展示 

登录状态下，管理员可以查看公司部门信息

#### 3.2.2 更改部门信息

登录状态下， 管理员可以对部门信息进行修改

#### 3.2.3 增加部门

登录状态下， 管理员可以增加部门信息

#### 3.2.4 查找部门信息

登录状态下,管理员可以通过部门编号查找部门信息

#### 3.25 删除部门信息

登录状态下,管理员可以删除部门信息,该部门员工进行随机分配给其他部门.

### 3.3 数据库结构

| 字段名      | 类型 | 作用         | 备注1 | 备注2 |
| ----------- | ---- | ------------ | ----- | ----- |
| did         | int  | 部门编号     | 主键  |       |
| dept_name   | char | 部门名       |       |       |
| dept_header | char | 部门负责人   | 唯一  |       |
| dept_member | int  | 部门人数     | 默认0 |       |
| dept_phone  | char | 部门联系电话 | 外键  |       |

### 3.4 接口说明

#### 3.4.1 部门信息展示

- ​	URL : http://127.0.0.1:8000/v1/department

- ​	请求方式：GET

- ​	响应格式：

| 字段 | 含义             | 类型 | 备注      |
| ---- | ---------------- | ---- | --------- |
| code | 状态码           | int  | 默认为200 |
| data | 具体返回在data中 | { }  |           |

> 响应示例：
>
> ```python
> json = {'code': 200 ,
>  'data': {'did': ‘1’, 'dept_name':'技术部', 'dept_header':'张三', 'dept_member':100, 'dept_phone':16666666666}
> }
> ```

#### 3.4.2 更改部门信息

- ​	URL : http://127.0.0.1:8000/v1/department

- ​	请求方式：PUT

- ​	请求格式：

| 字段        | 含义         | 类型 | 备注 |
| ----------- | ------------ | ---- | ---- |
| did         | 部门编号     | int  |      |
| dept_name   | 部门名       | char |      |
| dept_header | 部门负责人   | char |      |
| dept_phone  | 部门联系电话 | char |      |

> 请求示例：
>
> ```python
> {'did': 1000, 'dept_name':'技术部', 'dept_header':'张三', 'dept_phone':16666666666}
> ```

- 响应格式：

| 字段 | 含义 | 类型 | 备注          |
| ---- | ---- | ---- | ------------- |
| code | 状态 | int  | 默认正常为200 |

> 响应示例：
>
> ```python
> {'code': 200}
> ```

#### 3.4.3 查询部门信息

- URL : http://127.0.0.1:8000/v1/department
- 请求方式：POST
- 请求格式

| 字段 | 含义     | 类型 | 备注 |
| ---- | -------- | ---- | ---- |
| did  | 部门编号 | int  |      |

> 请求示例：
>
> ```python
> {'did': 1}
> ```

- 响应格式：

| 字段 | 含义             | 类型 | 备注                        |
| ---- | ---------------- | ---- | --------------------------- |
| code | 状态             | int  | 默认正常为200，异常请见下表 |
| data | 具体返回在data中 | { }  |                             |

> 响应示例：
>
> ```python
> {'code': 200 , 'data': {...}}
> ```

- 异常码

| 字段  | 含义                   | 类型 | 备注 |
| ----- | ---------------------- | ---- | ---- |
| 10402 | 输入了不存在的部门编号 |      |      |

#### 3.4.4 添加部门信息

- URL : http://127.0.0.1:8000/v1/department/info
- 请求方式：POST
- 请求格式：

| 字段        | 含义         | 类型 | 备注 |
| ----------- | ------------ | ---- | ---- |
| did         | 部门编号     | int  |      |
| dept_name   | 部门名       | char |      |
| dept_header | 部门负责人   | char |      |
| dept_phone  | 部门联系电话 | char |      |

> 请求示例：
>
> ```python
> {'did': 1000, 'dept_name':'技术部', 'dept_header':'张三', 'dept_phone':16666666666}
> ```

- 响应格式：

| 字段 | 含义 | 类型 | 备注          |
| ---- | ---- | ---- | ------------- |
| code | 状态 | int  | 默认正常为200 |

> 响应示例：
>
> ```python
> {'code': 200}
> ```

- 异常码

| 字段  | 含义                   | 类型 | 备注 |
| ----- | ---------------------- | ---- | ---- |
| 10400 | 提交的部门编号已经存在 |      |      |
| 10401 | 提交的部门名已经存在   |      |      |

#### 3.45 删除部门信息

- URL :  http://127.0.0.1:8000/v1/department

- 请求方式：delete

- 请求格式

  | 字段      | 含义     | 类型 | 备注 |
  | --------- | -------- | ---- | ---- |
  | did       | 部门编号 | int  |      |
  | dept_name | 部门名   | char |      |

- 请求示例

  {'did': 1000}or{'dept_name':'技术部'}

- 相应格式

  | 字段 | 含义 | 类型 | 备注          |
  | ---- | ---- | ---- | ------------- |
  | code | 状态 | int  | 默认正常为200 |

- 相应示例

  {'code': 200,"did":1000,'dept_name':'技术部'已删除}

  

## 4.员工薪资API

### 4.1概述

员工薪资展示模块

### 4.2事件定义

#### 4.2.1 薪资列表展示列表

在APIframe.html框架基础上，开发新的界面，用于显示所有的员工的工资信息(三年内所有员工的每个月的薪资记录)，也可通过相对应的年份和月份进行查找。

#### 4.2.2 更新员工薪资记录

在APIframe.html框架基础上，开发新的界面，用于对某个员工的薪资数据进行更新。

### 4.3数据库结构

| 字段名           | 类型         | 作用               | 备注                 |
| ---------------- | ------------ | ------------------ | -------------------- |
| sid              | char(15)     | 主键               | 用于签到表的关联     |
| year             | int(11)      | 年                 |                      |
| month            | int(11)      | 月                 |                      |
| base_salary      | decimal(8,2) | 基本工资           | 默认值：6000(可更新) |
| attendance_bonus | decimal(6,2) | 满勤奖             | 默认值：500(可更新)  |
| overtime_pay     | decimal(6,2) | 加班费             | 默认值：0(可更新)    |
| allowance        | decimal(6,2) | 项目奖金           | 默认值：500(可更新)  |
| tardy_cut        | decimal(6,2) | 迟到扣款           | 默认值：0(可更新)    |
| other_cut        | decimal(6,2) | 其他扣款           | 默认值：0(可更新)    |
| employee_id      | int(11)      | 外键关联。(一对多) |                      |

​    employee_id 关联的是员工信息表里的主键。获取员工基本信息，返回给前端页面。减少薪资数据库存储字段，解决数据冗余问题。

### 4.4接口说明

#### 4.4.1 员工薪资数据展示

- **GET请求获取全部数据**

  URL:http://127.0.0.1:8000/salary/display

  **请求方式**：GET

  **响应格式**：

  | 字段 | 含义             | 类型 | 备注                          |
  | ---- | ---------------- | ---- | ----------------------------- |
  | code | 状态             | int  | 默认正常为200，异常请见异常码 |
  | num  | 数据条数统计     | int  | 无                            |
  | dict | 具体返回在dict中 | { }  |                               |

  json 具体参数如下：

  ​	{'code': 200, 'num': 3, 'dict': {'1': { },'2':{ },'3':{ } } }

- **POST请求获取符合条件的数据**

  URL:http://127.0.0.1:8000/salary/display

  **请求方式**：POST

  **请求格式**：json 具体参数如下：

  | 字段  | 含义       | 类型             | 备注   |
  | ----- | ---------- | ---------------- | ------ |
  | year  | 查询的年份 | char(考虑到不填) | 非必填 |
  | month | 查询的月份 | char(考虑到不填) | 非必填 |

  请求示例：

  ​	{'year':‘2020’,'month':'全月'}

  **响应格式**：

  | 字段 | 含义             | 类型 | 备注                          |
  | ---- | ---------------- | ---- | ----------------------------- |
  | code | 状态             | int  | 默认正常为200，异常请见异常码 |
  | num  | 数据条数统计     | int  | 无                            |
  | dict | 具体返回在dict中 | { }  |                               |

  json 具体参数如下：

  ​	{'code': 200, 'num': 3, 'dict': {'1': { },'2':{ },'3':{ } } }

#### 4.4.2 员工薪资数据更新

- **POST请求获取符合条件的数据**

  URL:http://127.0.0.1:8000/salary/insert

  **请求方式**：POST

  **请求格式**：json 具体参数如下：

  | 字段             | 含义     | 类型         | 备注 |
  | ---------------- | -------- | ------------ | ---- |
  | eid              | 员工编号 | char(15)     | 必填 |
  | year             | 年份     | int(11)      | 必填 |
  | month            | 月份     | int(11)      | 必填 |
  | base_salary      | 基本工资 | decimal(8,2) | 必填 |
  | attendance_bonus | 满勤奖   | decimal(6,2) | 必填 |
  | overtime_pay     | 加班补贴 | decimal(8,2) | 必填 |
  | allowance        | 项目奖金 | decimal(8,2) | 必填 |
  | tardy_cut        | 迟到扣款 | decimal(8,2) | 必填 |
  | other_cut        | 其他扣款 | decimal(8,2) | 必填 |

  **响应格式**：

  json   具体参数如下：

  | 字段 | 含义             | 类型 | 备注                          |
  | ---- | ---------------- | ---- | ----------------------------- |
  | code | 状态             | int  | 默认正常为200，异常请见异常码 |
  | num  | 数据条数统计     | int  | 无                            |
  | dict | 具体返回在dict中 | { }  |                               |

  json 具体参数如下：

  ​	{'code': 200, 'num': 3, 'dict': {'1': { },'2':{ },'3':{ } } }

  **异常码**:

  | 异常吗 | 含义                        | 备注             |
  | ------ | --------------------------- | ---------------- |
  | 4000   | 年月格式不对(列如:20200/15) | 年月超过正常值   |
  | 4001   | 数据类型有误                | 薪资数据不是数字 |
  | 4008   | 没有该员工                  | 无               |

## 5.天气模块API

### 5.1概述

天气查询模块

### 5.2事件定义

在APIframe.html框架基础上，开发新的界面，用于显示所要查询的天气信息。

### 5.3接口说明

- **POST请求获取符合条件的数据**

  URL:http://127.0.0.1:8000/v1/weather/

  **请求方式**：POST

  **请求格式**：json 具体参数如下：

  | 字段 | 含义 | 类型 | 备注 |
  | ---- | ---- | ---- | ---- |
  | city | 城市 | char | 必填 |

  请求示例：

  ​	{'city':'西安'}

  **响应格式**：

  | 字段 | 含义 | 类型 | 备注                          |
  | ---- | ---- | ---- | ----------------------------- |
  | code | 状态 | int  | 默认正常为200，异常请见异常码 |
  | data | 数据 | { }  | 无                            |

  json 具体参数如下：

  ​	{'code': 200, 'data': {'city': '西安 ', 'a': {'day': '星期六 11/21', 'duoyun': '小雨', 'd': '西风', 'high': '7', 'low': '0℃'}, 'b': { }, 'c': { }, 'd': { }, 'e': { }, 'f': { }, 'g': { }}}

  ​	**说明**:a,b,c,d,e,f,g 字典类型，携带每天的天气数据,总共7天的数据。